angular.module("gadgetfreak",["ngRoute","ngSanitize","ui.bootstrap"]).config(["$routeProvider","$locationProvider",function(t,e){t.when("/",{templateUrl:"index.html",controller:"indexControler",controllerAs:"vm"}).when("/login",{templateUrl:"/shared/views/login/login.html",controller:"loginCtrl",controllerAs:"vm"}).when("/devicePost/:idDevice",{templateUrl:"/gadgetPost/gadgetpost.view.html",controller:"gadgetPostCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/shared/views/register/register.html",controller:"registerCtrl",controllerAs:"vm"}).when("/forum/post/:postId",{templateUrl:"/forum/forumPost/forumPost.pogled.html",controller:"forumPostCtrl",controllerAs:"vm"}).when("/add-post",{templateUrl:"/forum/addPost/addPost.pogled.html",controller:"addPostCtrl",controllerAs:"vm"}).when("/forum",{templateUrl:"/forum/forum.pogled.html",controller:"forumCtrl",controllerAs:"vm"}).when("/add-gadget",{templateUrl:"/add-gadget/addPost.view.html",controller:"addGadgetPostCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),e.html5Mode(!0)}]),function(){function t(t,e){var o=this;o.glavaStrani={},e.gadgetDataAll().then(function(t){o.data=t.data},function(t){})}t.$inject=["$scope","gadgetFreakData"],angular.module("gadgetfreak").controller("indexControler",t)}(),function(){function t(o,n){var r=this;r.sendLoginData=function(){if(!r.loginData.uname||!r.loginData.pword)return!(r.formError="Please fill all of the required fields.");r.loginUser(r.loginData.uname,r.loginData.pword)},r.loginUser=function(t,e){n.login({uname:t,pword:e}).then(function(t){o.location.href="/"},function(t){r.formError=t.data.sporocilo})}}t.$inject=["$window","authentication"],angular.module("gadgetfreak").controller("loginCtrl",t)}(),function(){function t(e,t){var o=this;o.sendRegisterData=function(){return o.regData.gender="",o.regData&&o.regData.name&&o.regData.last&&o.regData.email&&(""!=o.regData.gender1||""!=o.regData.gender2)&&o.regData.city&&o.regData.uname&&o.regData.country&&o.regData.pword&&o.regData.cpword?o.regData.pword!=o.regData.cpword?(o.formError="",o.pwordError="",!(o.matchError="Passwords must match.")):(o.regData.gender1?o.regData.gender=o.regData.gender1:o.regData.gender=o.regData.gender2,void o.regUser()):!(o.formError="Please fill all the fields.")},o.regUser=function(){t.registration({name:o.regData.name,uname:o.regData.uname,pword:o.regData.pword}).then(function(t){e.location.href="/"},function(t){o.formError=t.data.message})}}t.$inject=["$window","authentication"],angular.module("gadgetfreak").controller("registerCtrl",t)}(),function(){function t(e,t){var o=this;o.sendData=function(){o.data&&o.data.phone&&o.data.pic?t.postGadget({phone:o.data.phone,pic:o.data.pic,brand:o.data.brand,generation:o.data.gen,released:o.data.released,predecessor:o.data.predecessor,dimensions:o.data.dim,weight:o.data.weight,os:o.data.os,cpu:o.data.cpu,modem:o.data.modem,memory:o.data.memory,storage:o.data.storage,battery:o.data.battery,display:o.data.dis,rear_camera:o.data.rear_camera,front_camera:o.data.front_camera,sound:o.data.sound}).then(function(t){console.log(t),e.location.href="/"},function(t){alert(t.e)}):o.formError="Please fill in the field."}}t.$inject=["$window","gadgetFreakData"],angular.module("gadgetfreak").controller("addGadgetPostCtrl",t)}(),function(){function t(e,n,t){var r=this;r.deviceData=t,r.commentId="",null!=t.idComment&&0<t.idComment.length&&(r.commentId=t.idComment),r.modalWin={close:function(){e.close()},closeS:function(t){e.close(t)}},r.sendData=function(){return r.formError="",r.commentData.name="Beta",r.commentData.name&&r.commentData.stars&&r.commentData.comment?(""==r.commentId?r.addComment(r.deviceData.idDevice,r.commentData):r.editComment(r.deviceData.idDevice,r.commentData,r.commentId),!1):!(r.formError="Please fill all of the required fields.")},r.addComment=function(t,e){n.addCommentByID(t,{currentUser:e.name,stars:e.stars,content:e.comment}).then(function(t){r.modalWin.closeS(t.data)},function(t){r.formError="You need to be logged in."})},r.editComment=function(t,e,o){n.editCommentByID(t,{currentUser:e.name,stars:e.stars,context:e.comment},o).then(function(t){r.modalWin.closeS(t.data)},function(t){r.formError="Error!"})}}t.$inject=["$uibModalInstance","gadgetFreakData","podrobnostiLokacije"],angular.module("gadgetfreak").controller("commentModalWin",t)}(),function(){var t=function(n,o){return{gadgetDataAll:function(){return n.get("/api/devicePost/")},gadgetDataById:function(t){return n.get("/api/devicePost/"+t)},postGadget:function(t){return n.post("/api/devicePost",t)},addCommentByID:function(t,e){return n.post("/api/devicePost/"+t+"/comment",e,{headers:{Authorization:"Bearer "+o.getToken()}})},editCommentByID:function(t,e,o){return n.put("/api/devicePost/"+t+"/comment/"+o,e)},loginUser:function(t){return n.post("/api/login/",t)},regUser:function(t){return n.post("/api/register/",t)},removeComment:function(t,e){return n.delete("/api/devicePost/"+t+"/comment/"+e)}}};t.$inject=["$http","authentication"],angular.module("gadgetfreak").service("gadgetFreakData",t)}(),angular.module("gadgetfreak").filter("formatComments",function(){return function(t,e){if(!angular.isObject(t))return t;var o=[];for(var n in t)o.push(t[n]);return e?o.sort(function(t,e){return new Date(e.date)-new Date(t.date)}):o.sort(function(t,e){return new Date(t.date)-new Date(e.date)}),o}}),function(){function t(t,e,n,o){var r=this;r.idDevice=t.idDevice,r.commentsOffset=0,r.asc=!0,o.currentUser()&&(r.currentUserAd=o.currentUser().admin),r.commentOffsetInc=function(){r.commentsOffset+4<r.data.comments.length&&(r.commentsOffset+=5)},r.commentOffsetDec=function(){0<r.commentsOffset&&(r.commentsOffset-=5)},r.commentSortType=function(){r.asc=!r.asc},r.showCommentWindow=function(){e.open({templateUrl:"/commentModalWin/commentModalWin.view.html",controller:"commentModalWin",controllerAs:"vm",resolve:{podrobnostiLokacije:function(){return{idDevice:r.idDevice}}}}).result.then(function(t){void 0!==t&&r.data.comments.push(t)},function(t){alert("There was an error the comment didn't post.")})},r.editCommentWindow=function(n){e.open({templateUrl:"/commentModalWin/commentModalWin.view.html",controller:"commentModalWin",controllerAs:"vm",resolve:{podrobnostiLokacije:function(){return{idDevice:r.idDevice,idComment:n}}}}).result.then(function(t){if(void 0!==t){var e=r.data.comments.map(function(t){return t._id}).indexOf(n),o=r.data.comments[e];r.data.comments.splice(e,1),o.content=t.content,o.stars=t.stars,r.data.comments.push(o)}},function(t){alert("There was an error the comment didn't change.")})},r.removeComment=function(o){console.log(o),n.removeComment(r.idDevice,o).then(function(t){var e=r.data.comments.map(function(t){return t._id}).indexOf(o);r.data.comments.splice(e,1)},function(t){console.log(t.e)})},n.gadgetDataById(r.idDevice).then(function(t){r.data=t.data,r.title={title:t.data.frontPage.phone}},function(t){console.log(t.e)}),r.title={title:r.idDevice}}t.$inject=["$routeParams","$uibModal","gadgetFreakData","authentication"],angular.module("gadgetfreak").controller("gadgetPostCtrl",t)}(),function(){function t(e,o){var n=function(t){return decodeURIComponent(Array.prototype.map.call(e.atob(t),function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))},r=function(t){e.localStorage["gadgetfreak-token"]=t},a=function(){return e.localStorage["gadgetfreak-token"]},i=function(){var t=a();return!!t&&JSON.parse(n(t.split(".")[1])).dataCreated>Date.now()/1e3};return{setToken:r,getToken:a,login:function(t){return o.post("/api/login",t).then(function(t){r(t.data.token)})},registration:function(t){return o.post("/api/registration",t).then(function(t){r(t.data.token)})},loggedIn:i,currentUser:function(){if(i()){var t=a(),e=JSON.parse(n(t.split(".")[1]));return{uname:e.email,name:e.name,admin:e.admin}}},logout:function(){e.localStorage.removeItem("gadgetfreak-token")}}}t.$inject=["$window","$http"],angular.module("gadgetfreak").service("authentication",t)}(),angular.module("gadgetfreak").directive("showStars",function(){return{restrict:"EA",scope:{currentStars:"=stars"},templateUrl:"/shared/directive/showStars/stars.html"}}),function(){var t=function(a,i){return{restrict:"A",scope:{tweet:"=",tweetUrl:"="},link:function(t,e,o){a.twttr?r():$.getScript("//platform.twitter.com/widgets.js",function(){r()});var n=!1;function r(){if(t.tweet||n)e.html('<a href="https://twitter.com/share" class="twitter-share-button" data-text="Chek out this phone '+i.absUrl()+'" data-url="'+(t.tweetUrl||i.absUrl())+'">Tweet</a>'),a.twttr.widgets.load(e.parent()[0]);else{n=!0;var o=t.$watch("tweet",function(t,e){t&&(r(),o())})}}}}};t.$inject=["$window","$location"],angular.module("gadgetfreak").directive("tweet",t)}(),angular.module("gadgetfreak").directive("navigation",function(){return{restrict:"EA",templateUrl:"/shared/directive/navigation/navigation.template.html",controller:"navigationCtrl",controllerAs:"navvm"}}),function(){function t(t,e,o){var n=this;n.trenutnaLokacija=t.path(),n.isLogged=o.loggedIn(),n.currentUser=o.currentUser(),n.currentUser&&(n.currentUserAd=n.currentUser.admin),n.logout=function(){o.logout(),t.path("/"),e.reload()}}t.$inject=["$location","$route","authentication"],angular.module("gadgetfreak").controller("navigationCtrl",t)}(),angular.module("gadgetfreak").controller("forumCtrl",function t(e,o,n,r,a){var i=this;i.currentPage=1,i.header={title:"Welcome to the forum!"},a.currentUser()&&(i.user=a.currentUser().uname,i.currentUserAd=a.currentUser().admin,console.log(i.currentUserAd)),i.getForumData=function(){n.forumPosts.then(function(t){return i.message=0<t.data.length?"dobro je":"Not found!",i.data={len:t.length,forumPosts:t.data},i.data},function(t){i.message="There seems to be something wrong.",console.log(t.e)})},i.update=function(t,e){},i.showModal=function(o){i.getForumData(),r.open({templateUrl:"/replyModal/replyModal.pogled.html",controller:"replyModalCtrl",controllerAs:"vm",resolve:{postId:function(){return o}}}).result.then(function(t){if(void 0!==t){var e=i.data.forumPosts.map(function(t){return t._id}).indexOf(o);i.data.forumPosts[e].content=t.content}},function(t){alert("There was an error the comment didn't post.")})},i.deletePost=function(e){n.deletePost(e).then(function(t){alert("Successfully deleted!"),i.data.forumPosts=i.data.forumPosts.filter(function(t){return t._id!=e})},function(t){alert("Error!"),console.log(t.e)})},i.data=i.getForumData(),t.$inject=["$rootScope","$scope","forumData","$uibModal","authentication"]}),function(){var t=function(o,t){return{addPost:function(t){return o.post("/api/forum",t)},forumPosts:o.get("/api/forum"),edit:function(t,e){return o.put("/api/forum/"+t+"/edit",e)},deletePost:function(t){return o.delete("/api/forum/"+t)}}};t.$inject=["$http","authentication"],angular.module("gadgetfreak").service("forumData",t)}(),function(){var t=function(o,t){return{replyPost:function(t,e){return o.post("/api/forum/"+t,e)},forumPost:function(t){return o.get("/api/forum/"+t)},deleteReply:function(t,e){return o.delete("/api/forum/"+t+"/"+e)}}};t.$inject=["$http"],angular.module("gadgetfreak").service("forumPostData",t)}(),function(){function t(t,e,o,n){var r=this;r.header={title:"Wwwelcome to the forum!"},r.loggedIn=n.loggedIn(),r.postId=e.postId,r.getForumPostData=function(){o.forumPost(r.postId).then(function(t){r.message=0<t.data.length?"dobro je":"Not found!",r.url="/api/forum/"+r.postId,r.data={forumPost:t.data}},function(t){r.message="Not found!",console.log(t.e)})},n.currentUser()&&(r.user=n.currentUser().uname),r.replyPost=function(){r.dataz={user:r.user,reply:r.reply},r.reply?o.replyPost(r.postId,r.dataz).then(function(t){r.message="Success!",r.getForumPostData()},function(t){r.message="Error!",console.log(t.e)}):r.message="Comment requires at least one character."},r.deleteReply=function(t,e){o.deleteReply(t,e).then(function(t){alert("Successfully deleted!"),r.getForumPostData()},function(t){alert("Error!"),console.log(t.e)})},r.getForumPostData()}t.$inject=["$scope","$routeParams","forumPostData","authentication"],angular.module("gadgetfreak").controller("forumPostCtrl",t)}(),function(){function t(t,e,o,n){var r=this;r.postId=o,r.modalnoOkno={preklici:function(){e.close()},closeS:function(t){e.close(t)}},r.put=function(t){r.data={content:t},n.edit(r.postId,r.data).then(function(t){r.modalnoOkno.closeS(t.data)},function(t){alert("Error!")})}}t.$inject=["$rootScope","$uibModalInstance","postId","forumData"],angular.module("gadgetfreak").controller("replyModalCtrl",t)}();